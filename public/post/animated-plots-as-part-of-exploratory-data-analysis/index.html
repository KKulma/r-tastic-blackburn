<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.47.1" />

  <title>Animated Plots As Part Of Exploratory Data Analysis &middot; r-tastic</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Kasia Kulma</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2018. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Animated Plots As Part Of Exploratory Data Analysis</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>30 May 2017</time>
  </div>

  

  
  
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/data-vis">data vis</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/uk-police-data">uk police data</a>
    
  </div>
  
  

</div>

  

<p>The internet seems to be booming with blog posts on animated graphs, whether it&rsquo;s for more serious purposes or not so much. I didn&rsquo;t think anything more of it than just a gimmick or a cool way of spicing up your conference talk. However, I&rsquo;m a total convert now and <strong>in this post I want to show a real value that such graph can add to your (absolutely serious!) exploratory analysis.</strong></p>

<p><br></p>

<h3 id="import-of-metropolitan-police-data">IMPORT OF METROPOLITAN POLICE DATA</h3>

<p>As an example, I&rsquo;ll use geospatial data about crime and policing in the UK, freely available <a href="https://data.police.uk/data/">here</a>. As I live in London, quite naturally I chose data for <strong>Metropolitan Police</strong> region, starting from <strong>January 2016 to March 2017, with only <em>Include crime data</em> option ticked.</strong>.</p>

<p>The data are downloaded in the form of list of folders, each containing data for any specified month. In order to smoothly find and append those files, I used <code>dir()</code> function (after moving the folders to the working directory first, bien s√ªr):</p>

<pre><code>london_files &lt;- dir(recursive = T, pattern = &quot;*metropolitan-street.csv&quot;, full.names=TRUE)
london_files
</code></pre>

<pre><code>##  [1] &quot;./london_police_data/2016-01/2016-01-metropolitan-street.csv&quot;
##  [2] &quot;./london_police_data/2016-02/2016-02-metropolitan-street.csv&quot;
##  [3] &quot;./london_police_data/2016-03/2016-03-metropolitan-street.csv&quot;
##  [4] &quot;./london_police_data/2016-04/2016-04-metropolitan-street.csv&quot;
##  [5] &quot;./london_police_data/2016-05/2016-05-metropolitan-street.csv&quot;
##  [6] &quot;./london_police_data/2016-06/2016-06-metropolitan-street.csv&quot;
##  [7] &quot;./london_police_data/2016-07/2016-07-metropolitan-street.csv&quot;
##  [8] &quot;./london_police_data/2016-08/2016-08-metropolitan-street.csv&quot;
##  [9] &quot;./london_police_data/2016-09/2016-09-metropolitan-street.csv&quot;
## [10] &quot;./london_police_data/2016-10/2016-10-metropolitan-street.csv&quot;
## [11] &quot;./london_police_data/2016-11/2016-11-metropolitan-street.csv&quot;
## [12] &quot;./london_police_data/2016-12/2016-12-metropolitan-street.csv&quot;
## [13] &quot;./london_police_data/2017-01/2017-01-metropolitan-street.csv&quot;
## [14] &quot;./london_police_data/2017-02/2017-02-metropolitan-street.csv&quot;
## [15] &quot;./london_police_data/2017-03/2017-03-metropolitan-street.csv&quot;
</code></pre>

<p>This function recognizes all the specified files (here: csv files ending with <em>metropolitan-street</em> string) in the main folder, as well as sub-folders, genius! As you can see, thanks to <code>full.names = TRUE</code>, the object will return not only files&rsquo; names, but also their paths.</p>

<p>Next, I only need to append identified files&hellip;</p>

<pre><code>london_police_data &lt;- do.call(rbind,lapply(london_files, read.csv))
str(london_police_data)
</code></pre>

<pre><code>## 'data.frame':    1237778 obs. of  12 variables:
##  $ Crime.ID             : Factor w/ 905661 levels &quot;&quot;,&quot;0002285d1ab33fde301c313d3654e5bf45ce80eb10a90153f655a625dba32c30&quot;,..: 36371 1 1 1 1 1 1 1347 41162 24388 ...
##  $ Month                : Factor w/ 15 levels &quot;2016-01&quot;,&quot;2016-02&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Reported.by          : Factor w/ 1 level &quot;Metropolitan Police Service&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Falls.within         : Factor w/ 1 level &quot;Metropolitan Police Service&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Longitude            : num  -0.77 0.141 0.137 0.14 0.136 ...
##  $ Latitude             : num  51.8 51.6 51.6 51.6 51.6 ...
##  $ Location             : Factor w/ 35240 levels &quot;No Location&quot;,..: 17629 14588 14103 8507 10600 8507 7381 7183 8507 14588 ...
##  $ LSOA.code            : Factor w/ 6226 levels &quot;&quot;,&quot;E01000001&quot;,..: 4634 25 25 25 25 25 25 25 25 25 ...
##  $ LSOA.name            : Factor w/ 6226 levels &quot;&quot;,&quot;Aylesbury Vale 021B&quot;,..: 2 3 3 3 3 3 3 3 3 3 ...
##  $ Crime.type           : Factor w/ 14 levels &quot;Anti-social behaviour&quot;,..: 14 1 1 1 1 1 1 3 5 5 ...
##  $ Last.outcome.category: Factor w/ 24 levels &quot;&quot;,&quot;Awaiting court outcome&quot;,..: 8 1 1 1 1 1 1 8 13 18 ...
##  $ Context              : logi  NA NA NA NA NA NA ...
</code></pre>

<p>&hellip; and we can now start!</p>

<h4 id="creating-a-static-view-heatmap">CREATING A STATIC VIEW HEATMAP</h4>

<p>Let&rsquo;s have a look at crime types and their frequencies:</p>

<pre><code>sort(table(london_police_data$Crime.type))
</code></pre>

<pre><code>##
##        Possession of weapons                  Other crime
##                         5913                        13174
##                Bicycle theft                      Robbery
##                        22238                        29211
##                        Drugs        Theft from the person
##                        42629                        47064
##                 Public order                  Shoplifting
##                        56748                        59022
##    Criminal damage and arson                     Burglary
##                        77491                        87388
##                Vehicle crime                  Other theft
##                       114303                       133894
## Violence and sexual offences        Anti-social behaviour
##                       258061                       290642
</code></pre>

<p>It looks like <em>Possession of weapons</em> is, thankfully, the least common reported crime, so let&rsquo;s explore where those crimes usually happen and if there&rsquo;s any obvious seasonality. I&rsquo;ll start with creating a separate dataframe:</p>

<pre><code>library(dplyr)

weapon_map_data &lt;- london_police_data %&gt;%
  filter(Crime.type == &quot;Possession of weapons&quot;) %&gt;%
  select(Month, Longitude, Latitude, Crime.type)
</code></pre>

<p>And a quick peek into sample sizes&hellip;</p>

<pre><code>table(weapon_map_data$Month)
</code></pre>

<pre><code>##
## 2016-01 2016-02 2016-03 2016-04 2016-05 2016-06 2016-07 2016-08 2016-09
##     323     285     310     336     399     488     457     457     401
## 2016-10 2016-11 2016-12 2017-01 2017-02 2017-03
##     408     351     332     399     415     552
</code></pre>

<p>Next, I&rsquo;ll create a plain map of London using <code>ggmap</code> package:</p>

<pre><code>#install.packages(&quot;ggmap&quot;, type = &quot;source&quot;)
#devtools::install_github(&quot;hadley/ggplot2&quot;)
library(ggmap)
library(ggplot2)
library(evaluate)

evaluate(&quot;london_map = get_map(location = 'London', maptype='toner',  zoom = 10)&quot;)
</code></pre>

<pre><code>ggmap(london_map)
</code></pre>

<p><img src="/post/2017-05-30-animated-plots-as-part-of-exploratory-data-analysis_files/london_map-1.png" alt="" width="105%" height="105%"/></p>

<p>Not bad for two lines of code, ey!</p>

<p><em>(Note commented part with package installation: I had to install <code>ggmap</code> and <code>ggplot2</code> packages this way, otherwise the maps presented here wouldn&rsquo;t get generated)</em></p>

<p>Finally, here&rsquo;s a <strong>static</strong> heat map of weapon possession crimes in London, between January 2016 and March 2017:</p>

<pre><code>weapon_london_heat_map&lt;- ggmap(london_map, extent = &quot;device&quot;) +
  stat_density_2d(aes(x = Longitude, y = Latitude, fill = ..level.., alpha=1),
                  data=weapon_map_data, geom = &quot;polygon&quot;) +
  scale_fill_gradient(low = &quot;blue&quot;, high = &quot;red&quot;) +
  scale_alpha(range = c(0.00, 0.5), guide = FALSE)

weapon_london_heat_map
</code></pre>

<p><img src="/post/2017-05-30-animated-plots-as-part-of-exploratory-data-analysis_files/weapon_static-1.png" alt="" width="105%" height="105%"/></p>

<p>Not bad at all! We can now identify the crime hotspots, but there&rsquo;s no way we can infer anything about the crime seasonality. And here&rsquo;s where the first serious use of animated graphs comes in!</p>

<p><br></p>

<h3 id="creating-animated-single-view-heat-map">CREATING ANIMATED SINGLE-VIEW HEAT MAP</h3>

<p>For this purpose I use, now famous, <code>gganimate</code> package. If you ever thought that creating gif&rsquo;s with changing plots is hard, you&rsquo;d better start eyeballing the below code, because the only difference between the static and animated graph is <code>frame = Month</code> part added to graph&rsquo;s <code>aes()</code>. Simples.</p>

<pre><code>#devtools::install_github(&quot;dgrtwo/gganimate&quot;)
library(gganimate)

map_anime&lt;- ggmap(london_map, extent = &quot;device&quot;) +
  stat_density_2d(aes(x = Longitude, y = Latitude, frame = Month,
                      fill = ..level.., alpha=1),
                  data=weapon_map_data, geom = &quot;polygon&quot;) +
  scale_fill_gradient(low = &quot;blue&quot;, high = &quot;red&quot;) +
  scale_alpha(range = c(0.00, 0.5), guide = FALSE)
</code></pre>

<pre><code>gganimate(map_anime)
</code></pre>

<p><img src="/post/2017-05-30-animated-plots-as-part-of-exploratory-data-analysis_files/weapons_london.gif" alt="" width="105%" height="105%"/></p>

<p>From this animation alone (pretty much) you would know which of the following statements is true: i) weapon-carrying criminals like Easter and summer holidays, thus take time off from their criminal activity during these times and thus reducing the geographical range of such crimes, OR ii) during holiday periods the weapon-carrying criminals tend to &lsquo;focus&rsquo; on more central areas, supposedly while keeping up with their criminal activity&hellip;?</p>

<h4 id="creating-animated-multiple-view-heat-map">CREATING ANIMATED MULTIPLE-VIEW HEAT MAP</h4>

<p>Following the same logic, we can create a faceted-animated view of all crimes in London over 15 months. It goes like this:</p>

<pre><code># creating a new data.frame
all_map_data &lt;- london_police_data %&gt;%
  select(Month, Longitude, Latitude, Crime.type)

# animated all london crimes over time
all_london_heat_map&lt;- ggmap(london_map, extent = &quot;device&quot;) +
  stat_density_2d(aes(x = Longitude, y = Latitude, frame = Month,
                      fill = ..level.., alpha=1),
                  data=all_map_data, geom = &quot;polygon&quot;) +
  scale_fill_gradient(low = &quot;blue&quot;, high = &quot;red&quot;) +
  scale_alpha(range = c(0.00, 0.5), guide = FALSE) +
  facet_wrap(~ Crime.type, nrow = 3)

gganimate(all_london_heat_map)
</code></pre>

<p><img src="/post/2017-05-30-animated-plots-as-part-of-exploratory-data-analysis_files/all_london.gif" alt="" width="105%" height="105%"/></p>

<p>So, there you go! At the first glance it may look a bit chaotic, but such visualization will quickly make you realise that some crimes always have a narrow geographical range ( <em>Theft from the person</em> or <em>Other theft</em>, for example), especially compared to some with universally wide range (e.g. <em>Burglary</em> or <em>Criminal damage and arson</em>). And this is the first step for generating new questions and hypotheses, the integral (and very desirable) part of any exploratory analysis!</p>

<p>So, what do you think? Are you converted yet? :)</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/post/cluster-validation-in-unsupervised-machine-learning/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/post/cluster-validation-in-unsupervised-machine-learning/">Cluster Validation In Unsupervised Machine Learning</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/post/friendships-among-top-twitterers/">Friendships among top R-twitterers</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/post/friendships-among-top-twitterers/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'https-r-tastic-co-uk';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92539076-2', 'auto');
  ga('send', 'pageview');

</script>





</body>
</html>

